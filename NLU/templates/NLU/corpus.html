<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
      xmlns="http://www.w3.org/1999/html">
  <head>
    <meta charset="utf-8">
    <title>Cookit | Select Corpus</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="/static/bootstrap/css/custom.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../bower_components/html5shiv/dist/html5shiv.js"></script>
      <script src="../bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->

    <style>

	    body,html {
        width: 100%;
        height: 100%;
      }

      td {
        width: 50%;
      }

      /* Essential FileDrop zone element configuration: */
      .fd-zone {
        position: relative;
        overflow: hidden;
      }

      /* Hides <input type="file"> while simulating "Browse" button: */
      .fd-file {
        opacity: 0;
        font-size: 118px;
        position: absolute;
        right: 0;
        top: 0;
        z-index: 1;
        padding: 0;
        margin: 0;
        cursor: pointer;
        filter: alpha(opacity=0);
        font-family: sans-serif;
      }
    </style>

  </head>
  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="{% url 'home' %}" class="navbar-brand">{{ project_name }} </a>

        </div>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#">NLU ONLINE PROJ</a></li>
        </ul>

      </div>
    </div>
    <div id="main-content" class="bs-docs-section clearfix">
      <div class="container">
        <div class="row">
          <div class="col-lg-4">

            <div class="bs-component">
              <ul class="nav nav-pills nav-stacked">
                <li class="active"><a href="#">Select Corpus</a></li>
                <li><a href="#">More Spices</a></li>
                <li><a href="#">Hrl Download</a></li>

                <li><a href="#">Select Model</a></li>
                <li><a href="#">Train</a></li>
                <li><a href="#">Results</a></li>
              </ul>
            </div>
            <hr>
            <div class="bs-component" style="padding-top: 10px">
              <div class="panel panel-info">
                <div class="panel-heading">
                  <h3 class="panel-title">How To</h3>
                </div>
                <div class="panel-body" style="padding:15px 10px 0 0">
                  <ul>
                    <li>Single click the domain contents to select one domain.</li></br>
                    <li>Double click the domain contents to select all topics in this domain.</li></br>
                    <li>Double click the topic contents to select the topic.</li></br>
                    <li>Press the download button to download the corpus data or press next button to next step.</li></br>
                  </ul>

                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-8">
            <div class="well bs-component">
              <form class="form-horizontal">
                <fieldset>

                  <div class="form-group">
                    <label for="select" class="col-lg-2 control-label">Domain</label>
                    <div class="col-lg-10">
                      <select id="domain" multiple="" class="form-control" style="height: 200px">
                        {% for domain in domains %}
                          <option>{{ domain }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="select" class="col-lg-2 control-label">Topic</label>
                    <div id="{{ domain }}" class="topic col-lg-10">
                      <select multiple=""  class="form-control" style="height: 200px">
                      </select>
                    </div>
                    {% for domain, tops in topics.items %}
                      <div id="{{ domain }}" class="topic col-lg-10" hidden>
                        <select id="form-{{ domain }}" multiple=""  class="form-control" style="height: 200px">
                          {% for topic in tops %}
                            <option>{{ topic }}</option>
                          {% endfor %}
                        </select>
                      </div>
                    {% endfor %}
                  </div>

                  <div id="form-last" class="form-group">
                    <label for="table" class="col-lg-2 control-label">Selected Topics</label>
                    <div class="col-lg-10" style="padding-bottom: 40px">
                      <fieldset id="file-zone">
                        <textarea class="form-control" rows="5" id="submit-text"></textarea>
                      </fieldset>

                      </br>
                      <button id="download" type="button" class="btn btn-info">Download Data</button>
                      <button type="button" onclick="window.location.href='{% url 'hrl' %}'" class="btn btn-primary">Next</button>

                    </div>

                  </div>

                </fieldset>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>


    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/bootstrap/js/custom.js"></script>
{#    <link rel="stylesheet" href="/static/rollbar/css/jquery.rollbar.css" media="screen" />#}

{#    <script type="text/javascript" src="/static/rollbar/js/jquery.easing.1.3.js"></script>#}
{#    <script type="text/javascript" src="/static/rollbar/js/jquery.mousewheel.js"></script>#}
{#    <script type="text/javascript" src="/static/rollbar/js/jquery.rollbar.min.js"></script>#}

    <script src="/static/cookit/js/filedrop-min.js"></script>
    <script src="/static/cookit/js/xlsx.full.min.js"></script>

    <script type="text/javascript">
{#      $('body').rollbar({zIndex:100});#}

      var $submit_text = $('#submit-text');
      $('#domain').change(function(){

        $('.topic').hide();

        var domain = $(this).val();
        $('#'+$(this).children('option:selected').val()).show().children().dblclick(function(){
         $submit_text.val($submit_text.val()+domain+'.'+$(this).val()+';');
        });
        }).children().dblclick(function(){
        var domain = $(this).val();

        $.each($('#form-'+$(this).val()).children(), function(){
         $submit_text.val($submit_text.val()+domain+'.'+$(this).val()+';');
        });
      });


      $('#download').click(function(){
        var dl_btn = $(this);
        if(!$submit_text.val()) {
          alert('Please select at least one topic ! ');
          return
        }

        dl_btn.addClass('disabled');

        $.ajax({
          url: {% url 'downCorpus' %},
          timeout: 50000,
          type: 'post',
          data: {topics:$submit_text.val()},
          success: function (result) {
            dl_btn.removeClass('disabled');
            var filename = result.filename;
            $('#form-last').append(result.html);

            window.location.href='/static/temp/'+filename+'.zip';
            $submit_text.val('');

          }
        });
      });


      var zone = new FileDrop('file-zone', {'input':false});

      zone.event('send', function (files) {
        // FileList might contain multiple items.
        files.each(function (file) {

          var str = '';
          var reader = new FileReader();

            reader.onload = function(e){
            var data = e.target.result;
            try {
                var workbook = XLSX.read(data, {type: 'binary'});
            }
            catch(err) {
              alert("Not supported file: "+file.name);
              return;
            }

            var worksheet = workbook.Sheets[workbook.SheetNames[1]];
            for (z in worksheet) {

              if(z[0] === '!'|| z === 'C1' || z[0] !== 'C') continue;
              str += worksheet[z].v + ';'
            }
            $submit_text.val($submit_text.val()+str);

          };
          reader.readAsBinaryString(file.nativeFile);

        })
      })
    </script>
  </body>
</html>
