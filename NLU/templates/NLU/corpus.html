<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
      xmlns="http://www.w3.org/1999/html">
  <head>
    <meta charset="utf-8">
    <title>Cookit | Select Corpus</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css" media="screen">
    <link rel="stylesheet" href="/static/bootstrap/css/custom.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../bower_components/html5shiv/dist/html5shiv.js"></script>
      <script src="../bower_components/respond/dest/respond.min.js"></script>
    <![endif]-->

    <style>
      td {
        width: 50%;
      }
    </style>

  </head>
  <body>
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a href="{% url 'home' %}" class="navbar-brand">{{ project_name }} </a>

        </div>
        <ul class="nav navbar-nav navbar-right">
            <li><a href="#">NLU ONLINE PROJ</a></li>
        </ul>

      </div>
    </div>
    <div class="bs-docs-section clearfix">
      <div class="container">
        <div class="row">
          <div class="col-lg-4">

            <div class="bs-component">
              <ul class="nav nav-pills nav-stacked">
                <li class="active"><a href="#">Select Corpus</a></li>
                <li><a href="#">Select Audio Hrl</a></li>
                <li><a href="#">More Spices</a></li>
                <li><a href="#">Select Model</a></li>
                <li><a href="#">Train</a></li>
                <li><a href="#">Results</a></li>
              </ul>
            </div>
            <hr>
            <div class="bs-component" style="padding-top: 10px">
              <div class="panel panel-info">
                <div class="panel-heading">
                  <h3 class="panel-title">How To</h3>
                </div>
                <div class="panel-body" style="padding:15px 10px 0 0">
                  <ul>
                    <li>Single click the domain contents to select one domain.</li></br>
                    <li>Double click the domain contents to select all topics in this domain.</li></br>
                    <li>Double click the topic contents to select the topic.</li></br>
                    <li>Press the download button to download the corpus data or press next button to next step.</li></br>
                  </ul>

                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-8">
            <div class="well bs-component">
              <form class="form-horizontal">
                <fieldset>

                  <div class="form-group">
                    <label for="select" class="col-lg-2 control-label">Domain</label>
                    <div class="col-lg-10">
                      <select id="domain" multiple="" class="form-control" style="height: 200px">
                        {% for domain in domains %}
                          <option>{{ domain }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="select" class="col-lg-2 control-label">Topic</label>
                    <div id="{{ domain }}" class="topic col-lg-10">
                      <select multiple=""  class="form-control" style="height: 200px">
                      </select>
                    </div>
                    {% for domain, tops in topics.items %}
                      <div id="{{ domain }}" class="topic col-lg-10" hidden>
                        <select id="form-{{ domain }}" multiple=""  class="form-control" style="height: 200px">
                          {% for topic in tops %}
                            <option>{{ topic }}</option>
                          {% endfor %}
                        </select>
                      </div>
                    {% endfor %}
                  </div>

                  <div id="form-last" class="form-group">
                    <label for="table" class="col-lg-2 control-label">Selected Topics</label>
                    <div class="col-lg-10" style="padding-bottom: 40px">
                      <textarea class="form-control" rows="5" id="submit-text"></textarea>
                      </br>
                      <button id="download" type="button" class="btn btn-info">Download Data</button>
                      <button type="button" onclick="window.location.href='{% url 'hrl' %}'" class="btn btn-primary">Next</button>

                    </div>

                  </div>

                </fieldset>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>


    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/bootstrap/js/custom.js"></script>
    <script type="text/javascript">
      $('#domain').change(function(){

       $('.topic').hide();

       var domain = $(this).val();
       $('#'+$(this).children('option:selected').val()).show().children().dblclick(function(){
         $('#submit-text').val($('#submit-text').val()+domain+'.'+$(this).val()+';');
       });
      }).children().dblclick(function(){
       var domain = $(this).val();

       $.each($('#form-'+$(this).val()).children(), function(){
         $('#submit-text').val($('#submit-text').val()+domain+'.'+$(this).val()+';');
       });
      });


      $('#download').click(function(){
        var dl_btn = $(this);
        if(!$('#submit-text').val()) {
          alert('Please select at least one topic ! ');
          return
        }

        dl_btn.addClass('disabled');

        $.ajax({
          url: {% url 'downcorpus' %},
          timeout: 50000,
          type: 'post',
          data: {topics:$('#submit-text').val()},
          success: function (result) {
            dl_btn.removeClass('disabled');
            var filename = result.filename;
            $('#form-last').append(result.html);

            window.location.href='/static/temp/'+filename+'.zip';
            $('#submit-text').val('');

          }
        });
      })

    </script>
  </body>
</html>
